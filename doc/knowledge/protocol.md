# 通讯协议
## 网络模型
| 层         | 典型协议 / 标准        | 描述                                                             |
| ---------- | ---------------------- | ---------------------------------------------------------------- |
| 应用层     | HTTP、WebSocket、MQTT  | 为应用程序提供网络服务与通信接口                                 |
| 传输层     | TCP、UDP               | 提供端到端进程间的逻辑通信                                       |
| 网络层     | IP                     | 提供主机到主机的路径选择与分组转发                               |
| 数据链路层 | Ethernet、WiFi         | 提供相邻节点之间的帧传输与差错控制                               |
| 物理层     | RJ45、以太网物理层标准 | 提供原始比特流的透明传输，比如有光无光或者高低电压信号代表“0”“1” |

## http/https 协议
直译是超文本传输协议，浏览器常用。\
总理解 https = http + 加密层（SSL/TLS）, 对于传输中的性能问题，比如头压缩、分块传输、并行请求等，实际上是http的发展，而https则是在http基础上添加了加密层，解决了数据传输中的安全问题。
#### http
| 🌐&emsp;&emsp;&emsp;&emsp; | HTTP 1.0 | HTTP 1.1                | HTTP 2.0                       |
| :------------------------ | :------- | :---------------------- | :----------------------------- |
| **连接模型**              | 短连接   | 长连接                  | 多路复用                       |
| **队头阻塞**              | 严重     | 存在 (应用层 FIFO 阻塞) | 解决应用层阻塞 (存在 TCP 阻塞) |
| **传输层协议**            | TCP      | TCP                     | TCP                            |
| **传输格式**              | 文本     | 文本                    | 二进制分帧 (Binary Frame)      |
| **安全性**                | 明文     | 明文 (支持 SSL/TLS)     | 强制要求 TLS 1.2+              |
| **服务端推送**            | 不支持   | 不支持                  | 支持 (Server Push)             |
| **默认端口**              | 80       | 80/ TLS 443             | 443                            |

我们基于上面的表再理解一下概念：
:::tip 链接问题 🔗
- http 1.0 短连接，历史上网页非常简单，可能大多数情况下就一个html文件，服务器发送完一次消息之后主动TCP挥手
- http 1.1 长连接，保持TCP连接不断，但是存在应用级阻塞-如果只有一个TCP链接，前面的请求没有结束，其他请求就会阻塞；浏览器会主动建立多个TCP连接，Chrome默认6个，Firefox默认8个。
- http 2.0 多路复用，多个请求并行在一个TCP连接上，基本上同一个域名只会有一个TCP连接，数据传输是分数据帧交叉进行。
:::

#### https
直译 **HTTP over TLS**
- HTTP 1.1 的流程：TCP 握手 -> 直接发送 HTTP Request -> HTTP Response
- HTTPS 的流程：TCP 握手 -> TLS 握手（交换密钥/证书） -> 加密后的 HTTP Request -> 加密后的 HTTP Response

:::warning TLS 1.3 加解密过程
- 服务器向 CA 申请证书，包含公钥，自己保留私钥
- 客户端验证证书合法性、有效期、签名
- 客户端生成临时密钥对（EC），发临时公钥
- 服务器生成临时密钥对（EC），发临时公钥
- 双方用 ECDHE 算出相同的会话密钥
- 服务器用私钥签名，证明身份
- 之后全部使用会话密钥对称加密
:::


## websocket 协议
## MQTT 协议